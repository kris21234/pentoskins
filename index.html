<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<title>PENTO-CASE ‚Äî Case Battle</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
/* --- podstawowe style --- */
body {background:#0d0d0d; color:white; font-family:'Segoe UI',Arial; margin:0; min-height:100vh; overflow-x:hidden;}
header {position:fixed; top:0; left:0; right:0; height:70px; background:rgba(0,0,0,0.85); backdrop-filter:blur(12px);
        display:flex; justify-content:space-between; align-items:center; padding:0 30px; z-index:1000; border-bottom:2px solid #333;}
.header-left {display:flex; align-items:center; gap:20px;}
#balance {font-size:22px; font-weight:700; color:#ff3399; text-shadow:0 0 10px #ff3399;}

/* Punkty eventowe */
#eventPoints {font-size:18px; font-weight:700; color:#ffcc00; text-shadow:0 0 8px #ffcc00; margin-left:20px;}
#eventPointsIcon {width:32px; height:32px; cursor:pointer; margin-right:8px;}

/* Licznik kluczy */
#keysCount {font-size:18px; font-weight:700; color:#00ffff; text-shadow:0 0 8px #00ffff; margin-left:20px; text-align:center;}
#keysIcon {width:32px; height:32px; cursor:pointer; margin-right:8px;}

/* Przycisk WR√ìƒÜ - nowy styl */
.back-btn {
  position: fixed;
  top: 80px;
  right: 30px;
  padding: 10px 20px;
  background: #00cc66;
  color: #000;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  z-index: 999;
  box-shadow: 0 0 15px rgba(0, 204, 102, 0.7);
  transition: all 0.3s;
}

.back-btn:hover {
  background: #00ff80;
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(0, 255, 128, 0.9);
}

/* Awatar - POWIƒòKSZONY 4x i PRZESUNIƒòTY NI≈ªEJ */
.avatar-container {
  position: fixed;
  top: 80px; /* Przesuniƒôty ni≈ºej pod header */
  left: 30px;
  z-index: 999;
}

.avatar {
  width: 200px; /* 4x wiƒôkszy (50px * 4 = 200px) */
  height: 200px;
  border-radius: 20px; /* Wiƒôkszy border-radius dla lepszego wyglƒÖdu */
  border: 3px solid #ff3399;
  cursor: pointer;
  background: #1a1a1a;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  box-shadow: 0 0 20px rgba(255, 51, 153, 0.5);
  transition: transform 0.3s, box-shadow 0.3s;
  position: relative;
}

.avatar:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px rgba(255, 51, 153, 0.8);
}

.avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  position: relative;
  z-index: 2;
}

.avatar-default {
  color: #666;
  font-size: 16px;
  text-align: center;
  padding: 10px;
  position: relative;
  z-index: 2;
}

/* ANIMACJE AWATARA - TERAZ POD ZDJƒòCIEM */
.avatar-animation {
  position: absolute;
  top: -25px;
  left: -25px;
  width: 250px;
  height: 250px;
  pointer-events: none;
  z-index: 1; /* POD zdjƒôciem */
  border-radius: 30px;
  overflow: hidden;
}

/* 1. Animacja ognistej aura */
.fire-aura {
  background: linear-gradient(45deg, #ff3300, #ff6600, #ff3300);
  animation: firePulse 2s infinite, fireRotate 4s infinite linear;
  opacity: 0.7;
}

@keyframes firePulse {
  0%, 100% { box-shadow: 0 0 30px #ff3300, 0 0 50px #ff6600; }
  50% { box-shadow: 0 0 60px #ff3300, 0 0 90px #ff6600, 0 0 120px #ff3300; }
}

@keyframes fireRotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.fire-aura::before {
  content: '';
  position: absolute;
  top: 10px;
  left: 10px;
  right: 10px;
  bottom: 10px;
  background: linear-gradient(45deg, transparent 30%, #ff9900 50%, transparent 70%);
  animation: fireInner 1.5s infinite linear;
  border-radius: 25px;
}

@keyframes fireInner {
  0% { transform: rotate(0deg); opacity: 0.5; }
  100% { transform: rotate(360deg); opacity: 0.8; }
}

/* 2. Animacja elektrycznych b≈Çyskawic */
.electric-sparks {
  background: transparent;
  border: 3px solid #00ffff;
  animation: electricPulse 1.5s infinite;
}

@keyframes electricPulse {
  0%, 100% { 
    box-shadow: 0 0 15px #00ffff, 0 0 30px #00ffff, inset 0 0 15px #00ffff;
    border-color: #00ffff;
  }
  50% { 
    box-shadow: 0 0 30px #00ffff, 0 0 60px #00ffff, 0 0 90px #00ffff, inset 0 0 30px #00ffff;
    border-color: #00ffaa;
  }
}

.electric-sparks::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 50%;
  height: 100%;
  background: linear-gradient(90deg, transparent, #00ffff, transparent);
  animation: electricStrike 2s infinite;
}

@keyframes electricStrike {
  0% { left: -100%; }
  100% { left: 200%; }
}

.electric-sparks::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 20%, #00ffff 3px, transparent 4px),
    radial-gradient(circle at 80% 20%, #00ffff 3px, transparent 4px),
    radial-gradient(circle at 20% 80%, #00ffff 3px, transparent 4px),
    radial-gradient(circle at 80% 80%, #00ffff 3px, transparent 4px);
  animation: sparkle 0.8s infinite;
}

@keyframes sparkle {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 1; }
}

/* 3. Animacja magicznego krƒôgu */
.magic-circle {
  background: transparent;
  border: 4px solid #ff00ff;
}

.magic-circle::before {
  content: '';
  position: absolute;
  top: 15px;
  left: 15px;
  right: 15px;
  bottom: 15px;
  border: 3px solid #00ffff;
  border-radius: 25px;
  animation: circleRotate 3s infinite linear;
}

.magic-circle::after {
  content: '';
  position: absolute;
  top: 30px;
  left: 30px;
  right: 30px;
  bottom: 30px;
  border: 2px solid #ffff00;
  border-radius: 20px;
  animation: circleRotateReverse 2s infinite linear;
}

@keyframes circleRotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes circleRotateReverse {
  0% { transform: rotate(360deg); }
  100% { transform: rotate(0deg); }
}

.magic-circle .rune {
  position: absolute;
  color: #ff00ff;
  font-size: 20px;
  font-weight: bold;
  animation: runeGlow 2s infinite;
  z-index: 1;
}

.magic-circle .rune:nth-child(1) { top: 20px; left: 50%; transform: translateX(-50%); }
.magic-circle .rune:nth-child(2) { top: 50%; right: 20px; transform: translateY(-50%); }
.magic-circle .rune:nth-child(3) { bottom: 20px; left: 50%; transform: translateX(-50%); }
.magic-circle .rune:nth-child(4) { top: 50%; left: 20px; transform: translateY(-50%); }

@keyframes runeGlow {
  0%, 100% { text-shadow: 0 0 8px #ff00ff; opacity: 0.7; }
  50% { text-shadow: 0 0 20px #ff00ff, 0 0 35px #ff00ff; opacity: 1; }
}

/* 4. Animacja kosmicznej galaktyki */
.cosmic-galaxy {
  background: linear-gradient(45deg, #000033, #330066, #000033);
  animation: cosmicShift 4s infinite;
}

@keyframes cosmicShift {
  0%, 100% { background: linear-gradient(45deg, #000033, #330066, #000033); }
  50% { background: linear-gradient(135deg, #330066, #000033, #330066); }
}

.cosmic-galaxy::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 30% 30%, #ffffff 3px, transparent 4px),
    radial-gradient(circle at 70% 20%, #ffff00 2px, transparent 3px),
    radial-gradient(circle at 20% 70%, #00ffff 2px, transparent 3px),
    radial-gradient(circle at 80% 80%, #ff00ff 3px, transparent 4px);
  animation: starTwinkle 3s infinite;
}

@keyframes starTwinkle {
  0%, 100% { opacity: 0.3; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.1); }
}

.cosmic-galaxy::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 120px;
  height: 120px;
  background: radial-gradient(circle, #ffffff, #00ffff, transparent 70%);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  animation: nebulaPulse 3s infinite;
  opacity: 0.3;
}

@keyframes nebulaPulse {
  0%, 100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.2; }
  50% { transform: translate(-50%, -50%) scale(1.3); opacity: 0.4; }
}

/* 5. Animacja z≈Çotej chwa≈Çy */
.golden-glory {
  background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
  animation: goldShine 2s infinite;
  opacity: 0.8;
}

@keyframes goldShine {
  0%, 100% { 
    box-shadow: 0 0 30px #ffd700, 0 0 60px #ffd700;
    filter: brightness(1);
  }
  50% { 
    box-shadow: 0 0 60px #ffd700, 0 0 120px #ffd700, 0 0 180px #ffd700;
    filter: brightness(1.3);
  }
}

.golden-glory::before {
  content: '‚òÖ';
  position: absolute;
  top: 15px;
  left: 15px;
  color: #ffffff;
  font-size: 24px;
  animation: starFloat 3s infinite;
}

.golden-glory::after {
  content: '‚òÖ';
  position: absolute;
  bottom: 15px;
  right: 15px;
  color: #ffffff;
  font-size: 24px;
  animation: starFloat 3s infinite reverse;
}

@keyframes starFloat {
  0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
  50% { transform: translateY(-15px) rotate(180deg); opacity: 1; }
}

.golden-glory .ray {
  position: absolute;
  background: #ffffff;
  width: 4px;
  height: 40px;
  top: 50%;
  left: 50%;
  transform-origin: center bottom;
  animation: rayRotate 4s infinite linear;
  opacity: 0.7;
}

.golden-glory .ray:nth-child(1) { transform: translate(-50%, -50%) rotate(0deg); }
.golden-glory .ray:nth-child(2) { transform: translate(-50%, -50%) rotate(45deg); }
.golden-glory .ray:nth-child(3) { transform: translate(-50%, -50%) rotate(90deg); }
.golden-glory .ray:nth-child(4) { transform: translate(-50%, -50%) rotate(135deg); }
.golden-glory .ray:nth-child(5) { transform: translate(-50%, -50%) rotate(180deg); }
.golden-glory .ray:nth-child(6) { transform: translate(-50%, -50%) rotate(225deg); }
.golden-glory .ray:nth-child(7) { transform: translate(-50%, -50%) rotate(270deg); }
.golden-glory .ray:nth-child(8) { transform: translate(-50%, -50%) rotate(315deg); }

@keyframes rayRotate {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Pasek levelu */
.level-container {
  position: absolute;
  top: 75px;
  left: 0;
  right: 0;
  text-align: center;
  z-index: 998;
}

.level-bar {
  width: 300px;
  height: 20px;
  background: #333;
  border-radius: 10px;
  margin: 0 auto;
  overflow: hidden;
  position: relative;
}

.level-progress {
  height: 100%;
  background: linear-gradient(90deg, #ff3399, #ff66bb);
  transition: width 0.3s;
}

.level-text {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  color: white;
  font-size: 12px;
  font-weight: 700;
  line-height: 20px;
  text-shadow: 1px 1px 2px #000;
}

.container {
  padding-top: 120px;
  text-align: center;
}

.btn-big {
  padding: 10px 22px;
  margin: 10px;
  background: #ff3399;
  color: #000;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.18s;
}

.btn-big:hover {
  background: #ff66bb;
  transform: scale(1.02);
}

.btn-big:disabled {
  background: #666;
  cursor: not-allowed;
  transform: none;
}

.case-card {
  display: inline-block;
  width: 200px;
  margin: 14px;
  background: #1a1a1a;
  border-radius: 12px;
  padding: 12px;
  border: 2px solid #444;
  cursor: pointer;
}

.case-card img {
  width: 150px;
  height: 150px;
  object-fit: contain;
}

.case-name {
  font-size: 16px;
  margin: 8px 0;
  color: #ff3399;
}

.case-price {
  font-size: 13px;
  color: #0f0;
}

/* full-size roll (case opening) */
.roll-container {
  width: 88%;
  max-width: 1100px;
  height: 220px;
  margin: 18px auto;
  border: 4px solid #ff3399;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
  background: #000;
  box-shadow: 0 0 40px rgba(255, 51, 153, 0.5);
  display: none;
}

.roll {
  display: flex;
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
}

.item {
  width: 220px;
  height: 220px;
  flex-shrink: 0;
  background: #222;
  display: flex;
  align-items: center;
  justify-content: center;
  border-right: 2px solid #000;
  position: relative;
}

.item img {
  width: 170px;
  height: 170px;
  object-fit: contain;
}

.item-chance {
  position: absolute;
  bottom: 5px;
  right: 5px;
  background: rgba(0, 0, 0, 0.8);
  color: #ffd700;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 8px;
  font-weight: bold;
}

.pointer {
  width: 14px;
  height: 170px;
  background: linear-gradient(transparent, #ff0066 20%, #ff66aa 50%, #ff0066 80%, transparent);
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border-radius: 12px;
  box-shadow: 0 0 50px #ff3399;
  z-index: 20;
  display: none;
}

/* battle small rolls inside player box */
.battle-area {
  padding: 18px;
  text-align: center;
}

.player-slot {
  display: inline-block;
  width: 200px;
  margin: 8px;
  background: #111;
  border-radius: 10px;
  padding: 8px;
  border: 2px solid #333;
  vertical-align: top;
  position: relative;
}

.player-slot.you {
  border-color: #00ff66;
}

.player-slot.winner {
  border: 4px solid gold !important;
  box-shadow: 0 0 60px gold !important;
}

.player-slot .name {
  color: #ff3399;
  font-weight: 700;
  margin-bottom: 6px;
}

.player-slot .box {
  width: 160px;
  height: 160px;
  margin: 0 auto;
  background: #000;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid #222;
  overflow: hidden;
  position: relative;
}

.player-slot.leading {
  box-shadow: 0 0 18px #3aff66;
  border-color: #3aff66;
}

.small-roll {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  display: flex;
  transition: left 5.2s cubic-bezier(0.22, 0.61, 0.36, 1);
}

.small-item {
  width: 160px;
  height: 160px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #111;
  border-right: 2px solid #000;
  position: relative;
}

.small-item-chance {
  position: absolute;
  bottom: 3px;
  right: 3px;
  background: rgba(0, 0, 0, 0.8);
  color: #ffd700;
  font-size: 8px;
  padding: 1px 4px;
  border-radius: 6px;
  font-weight: bold;
}

.player-slot .info {
  margin-top: 8px;
  font-size: 13px;
  color: #ccc;
}

.player-slot .val {
  color: #0f0;
  font-weight: 700;
}

.player-slot .count {
  color: #ffd700;
  font-weight: 700;
}

.round-counter {
  position: absolute;
  top: 5px;
  right: 5px;
  background: #ff3399;
  color: white;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 10px;
  font-weight: bold;
}

.battle-info {
  margin: 10px 0;
  padding: 8px;
  background: #1a1a1a;
  border-radius: 8px;
  border: 1px solid #333;
}

/* inventory */
#inventory {
  padding: 30px;
  display: none;
}

.inv-item {
  display: inline-block;
  width: 190px;
  margin: 12px;
  background: #222;
  padding: 12px;
  border-radius: 12px;
  position: relative;
  border: 2px solid transparent;
  transition: border-color 0.3s;
}

.inv-item.locked {
  border-color: #ffcc00;
  background: #2a2a1a;
}

.inv-item img {
  width: 140px;
  height: 100px;
  object-fit: contain;
  border-radius: 8px;
}

.inv-item-chance {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(0, 0, 0, 0.8);
  color: #ffd700;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 8px;
  font-weight: bold;
}

.inv-item-lock {
  position: absolute;
  top: 5px;
  left: 5px;
  background: rgba(0, 0, 0, 0.8);
  color: #ffcc00;
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
}

.small {
  font-size: 13px;
  color: #ccc;
}

/* shop */
.shop-item {
  display: inline-block;
  width: 180px;
  margin: 14px;
  background: #1a1a1a;
  border-radius: 12px;
  padding: 12px;
  border: 2px solid #444;
  vertical-align: top;
}

.shop-item img {
  width: 120px;
  height: 120px;
  object-fit: contain;
  border-radius: 8px;
}

.shop-item-name {
  font-size: 14px;
  margin: 8px 0;
  color: #ff3399;
  font-weight: 700;
}

.shop-item-price {
  font-size: 13px;
  color: #0f0;
  margin-bottom: 8px;
}

/* Event points shop */
.event-shop-item {
  display: inline-block;
  width: 200px;
  margin: 14px;
  background: #1a1a1a;
  border-radius: 12px;
  padding: 12px;
  border: 2px solid #ffcc00;
  vertical-align: top;
}

.event-shop-preview {
  width: 150px;
  height: 150px;
  margin: 0 auto;
  background: #000;
  border-radius: 8px;
  border: 2px solid #ffcc00;
  position: relative;
  overflow: hidden;
}

.event-shop-item-name {
  font-size: 14px;
  margin: 8px 0;
  color: #ffcc00;
  font-weight: 700;
}

.event-shop-item-price {
  font-size: 13px;
  color: #ffcc00;
  margin-bottom: 8px;
}

.event-shop-item-preview {
  margin-top: 8px;
  font-size: 12px;
  color: #ccc;
}

/* Sortowanie w ekwipunku */
.inventory-sort {
  margin: 30px 0 20px 0; /* Wiƒôkszy margines g√≥rny, ≈ºeby nie nachodzi≈Ç na pasek levela */
  text-align: center;
}

.sort-btn {
  padding: 8px 16px;
  margin: 0 5px;
  background: #ff6600; /* Pomara≈Ñczowy kolor */
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s;
  font-weight: 700;
}

.sort-btn:hover {
  background: #ff8833;
  transform: scale(1.05);
}

.sort-btn.active {
  background: #ff3399;
  box-shadow: 0 0 10px rgba(255, 51, 153, 0.5);
}

/* Kolekcja */
.collection-case {
  margin: 20px 0;
  padding: 15px;
  background: #1a1a1a;
  border-radius: 12px;
  border: 2px solid #444;
}

.collection-case-header {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 1px solid #333;
}

.collection-case-icon {
  width: 60px;
  height: 60px;
  margin-right: 15px;
  object-fit: contain;
}

.collection-case-info {
  flex: 1;
  text-align: left;
}

.collection-case-name {
  font-size: 20px;
  color: #ff3399;
  font-weight: 700;
  margin-bottom: 5px;
}

.collection-case-progress {
  font-size: 14px;
  color: #ccc;
}

.collection-case-completed {
  color: #0f0;
  font-weight: 700;
}

.collection-items {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}

.collection-item {
  width: 120px;
  height: 120px;
  background: #222;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  cursor: pointer;
  transition: all 0.3s;
  border: 2px solid #333;
}

.collection-item.collected {
  border-color: #ff3399;
  box-shadow: 0 0 10px rgba(255, 51, 153, 0.5);
}

.collection-item.missing {
  filter: brightness(0.3);
  cursor: not-allowed;
}

.collection-item img {
  width: 100px;
  height: 100px;
  object-fit: contain;
}

.collection-item-chance {
  position: absolute;
  bottom: 3px;
  right: 3px;
  background: rgba(0, 0, 0, 0.8);
  color: #ffd700;
  font-size: 9px;
  padding: 1px 4px;
  border-radius: 6px;
  font-weight: bold;
}

.collection-item-check {
  position: absolute;
  top: 3px;
  left: 3px;
  background: rgba(0, 0, 0, 0.8);
  color: #0f0;
  font-size: 12px;
  padding: 2px 5px;
  border-radius: 50%;
  font-weight: bold;
}

.collection-reward {
  margin-top: 15px;
  padding: 10px;
  background: #2a2a2a;
  border-radius: 8px;
  border: 1px solid #ffcc00;
}

.collection-reward.completed {
  background: #2a2a1a;
  border-color: #0f0;
}

.collection-reward-btn {
  padding: 8px 16px;
  background: #ffcc00;
  color: #000;
  border: none;
  border-radius: 6px;
  font-weight: 700;
  cursor: pointer;
  margin-top: 5px;
}

.collection-reward-btn:disabled {
  background: #666;
  cursor: not-allowed;
}

/* responsive */
@media (max-width: 900px) {
  .player-slot {
    width: 46%;
  }
  .inv-item {
    width: 46%;
  }
  .shop-item {
    width: 46%;
  }
  .avatar-container {
    position: relative;
    top: auto;
    left: auto;
    margin: 20px auto;
  }
  .avatar {
    width: 150px;
    height: 150px;
  }
  .avatar-animation {
    width: 200px;
    height: 200px;
    top: -25px;
    left: -25px;
  }
  .collection-item {
    width: 100px;
    height: 100px;
  }
  .collection-item img {
    width: 80px;
    height: 80px;
  }
  .back-btn {
    position: relative;
    top: auto;
    right: auto;
    margin: 10px;
  }
}

@media (max-width: 520px) {
  .player-slot {
    width: 100%;
  }
  .inv-item {
    width: 100%;
  }
  .case-card {
    width: 140px;
  }
  .shop-item {
    width: 100%;
  }
  .level-bar {
    width: 250px;
  }
  .avatar-container {
    position: relative;
    top: auto;
    left: auto;
    margin: 20px auto;
  }
  .avatar {
    width: 120px;
    height: 120px;
  }
  .avatar-animation {
    width: 170px;
    height: 170px;
    top: -25px;
    left: -25px;
  }
  .collection-item {
    width: 80px;
    height: 80px;
  }
  .collection-item img {
    width: 60px;
    height: 60px;
  }
  .collection-case-header {
    flex-direction: column;
    text-align: center;
  }
  .collection-case-icon {
    margin-right: 0;
    margin-bottom: 10px;
  }
  .back-btn {
    position: relative;
    top: auto;
    right: auto;
    margin: 10px;
  }
}
</style>
</head>
<body>
<header>
  <div class="header-left">
    <!-- Punkty eventowe -->
    <div id="eventPointsContainer" style="display:flex;align-items:center;cursor:pointer;" onclick="showEventShop()">
      <img id="eventPointsIcon" src="https://static.vecteezy.com/system/resources/thumbnails/027/722/096/small/coin-money-financial-png.png" alt="Event Points">
      <div id="eventPoints">0</div>
    </div>
    
    <!-- Licznik kluczy -->
    <div id="keysContainer" style="display:flex;align-items:center;margin-left:20px;">
      <img id="keysIcon" src="https://cdn-icons-png.freepik.com/512/7730/7730018.png" alt="Klucze" style="width:32px;height:32px;">
      <div id="keysCount">0</div>
    </div>
  </div>
  <div id="balance">1 000 z≈Ç</div>
</header>

<!-- Przycisk WR√ìƒÜ - teraz sta≈Çy w prawym g√≥rnym rogu -->
<button class="back-btn" onclick="backToMenu()" style="display:none;" id="backButton">WR√ìƒÜ</button>

<!-- AWATAR - TERAZ JEST TU, POD HEADEREM PO LEWEJ -->
<div class="avatar-container">
  <div class="avatar" id="avatar" onclick="changeAvatar()">
    <div class="avatar-default" id="avatarDefault">AWATAR</div>
  </div>
</div>

<div class="level-container">
  <div class="level-bar">
    <div class="level-progress" id="levelProgress"></div>
    <div class="level-text" id="levelText">Level 1 | 0/100 XP</div>
  </div>
</div>

<div class="container" id="mainMenu">
  <h1 style="font-size:36px;color:#ff3399;margin-bottom:8px">PENTO-CASE</h1>
  <div style="margin-bottom:16px">
    <button class="btn-big" onclick="showCases()">OTW√ìRZ SKRZYNKƒò</button>
    <button class="btn-big" onclick="showBattle()">CASE BATTLE</button>
    <button class="btn-big" onclick="showShop()">SKLEP</button>
  </div>
  <div style="margin-top:16px">
    <button class="btn-big" onclick="showInventory()">EKWIPUNEK</button>
    <button class="btn-big" onclick="showCollection()">KOLEKCJA</button>
  </div>
  <div class="small">Tryb: Case Battle - graj przeciw botom lokalnie.</div>
</div>

<!-- CASES SCREEN -->
<div id="casesScreen" style="display:none;text-align:center;padding-top:80px;">
  <h2 style="color:#ff3399;margin-top:20px">WYBIERZ SKRZYNKƒò</h2>
  <div style="margin-top:12px">
    <div class="case-card" onclick="openCase(1)"><img src="https://i.postimg.cc/8zjR0TkZ/sdfsdfdfssdfsdf-Photoroom.png"><div class="case-name">PENTO-CASE</div><div class="case-price">DARMOWA</div></div>
    <div class="case-card" onclick="openCase(2)"><img src="https://i.postimg.cc/tR3XQ6vB/Zrzut-ekranu-2025-11-19-214235-removebg-preview.png"><div class="case-name">DYCHA CASE</div><div class="case-price">1000 z≈Ç</div></div>
    <div class="case-card" onclick="openCase(3)"><img src="https://i.postimg.cc/G2Ty8xTk/dddddddd-removebg-preview.png"><div class="case-name">LEGEND CASE</div><div class="case-price">5000 z≈Ç</div></div>
    <div class="case-card" onclick="openCase(5)"><img src="https://i.postimg.cc/kM09QYFF/4-shoty-kamikaze.png"><div class="case-name">KAMIKAZE CASE</div><div class="case-price">10000 z≈Ç</div></div>
    <div class="case-card" onclick="openCase(4)"><img src="https://i.postimg.cc/1tkMv4yZ/Zrzut-ekranu-2025-11-25-144511-removebg-preview.png"><div class="case-name">RASZEI CASE</div><div class="case-price">20000 z≈Ç</div></div>
  </div>

  <img id="caseBox" style="width:220px;cursor:pointer;margin-top:20px" onclick="startRoll()" alt="case image">
  <div class="roll-container" id="rollContainer"><div class="roll" id="roll"></div></div>
  <div class="pointer" id="pointer"></div>
  <div id="result" style="margin-top:12px"></div>
</div>

<!-- BATTLE / CASE BATTLE SCREEN -->
<div id="battleScreen" style="display:none;padding-top:80px;text-align:center;">
  <h2 style="color:#ff3399;margin-top:8px">CASE BATTLE ‚Äî Lokalnie vs Boty</h2>

  <div style="margin:10px">
    <label class="small">Wybierz liczbƒô bot√≥w:</label><br>
    <button class="btn-big" onclick="battleSetBots(1)">1 BOT</button>
    <button class="btn-big" onclick="battleSetBots(2)">2 BOTY</button>
    <button class="btn-big" onclick="battleSetBots(3)">3 BOTY</button>
  </div>

  <div style="margin-top:8px">
    <label class="small">Wybierz skrzynki (mo≈ºesz dodaƒá maksymalnie 20):</label><br>
    <div class="case-card" style="display:inline-block" onclick="battleAddCase(1)"><img src="https://i.postimg.cc/8zjR0TkZ/sdfsdfdfssdfsdf-Photoroom.png"><div class="case-name">PENTO-CASE</div></div>
    <div class="case-card" style="display:inline-block" onclick="battleAddCase(2)"><img src="https://i.postimg.cc/tR3XQ6vB/Zrzut-ekranu-2025-11-19-214235-removebg-preview.png"><div class="case-name">DYCHA CASE</div></div>
    <div class="case-card" style="display:inline-block" onclick="battleAddCase(3)"><img src="https://i.postimg.cc/G2Ty8xTk/dddddddd-removebg-preview.png"><div class="case-name">LEGEND CASE</div></div>
    <div class="case-card" style="display:inline-block" onclick="battleAddCase(5)"><img src="https://i.postimg.cc/kM09QYFF/4-shoty-kamikaze.png"><div class="case-name">KAMIKAZE CASE</div></div>
    <div class="case-card" style="display:inline-block" onclick="battleAddCase(4)"><img src="https://i.postimg.cc/1tkMv4yZ/Zrzut-ekranu-2025-11-25-144511-removebg-preview.png"><div class="case-name">RASZEI CASE</div></div>
  </div>

  <div id="battleSelected" style="margin:12px;padding:10px;background:#111;border-radius:8px;border:1px solid #333">Brak skrzynek</div>
  
  <div class="battle-info">
    <div class="small">Wybrano: <span id="battleCount">0</span>/20 skrzynek | Koszt: <span id="battleCost">0</span> z≈Ç</div>
  </div>

  <div style="margin-top:12px">
    <button class="btn-big" id="startBattleBtn" onclick="startBattle()">START BATTLE</button>
    <small class="small">Wyniki generowane lokalnie. Animacje wszystkich graczy odtwarzane jednocze≈õnie.</small>
  </div>

  <div id="battleArea" class="battle-area" style="margin-top:18px"></div>
  <div id="battleResult" style="margin-top:16px"></div>
</div>

<!-- SHOP SCREEN -->
<div id="shopScreen" style="display:none;padding-top:80px;text-align:center;">
  <h2 style="color:#ff3399;margin-top:20px">SKLEP</h2>
  <div style="margin-top:12px" id="shopItems">
    <!-- Shop items will be generated here -->
  </div>
</div>

<!-- EVENT SHOP SCREEN -->
<div id="eventShopScreen" style="display:none;padding-top:80px;text-align:center;">
  <h2 style="color:#ffcc00;margin-top:20px">SKLEP EVENTOWY</h2>
  <div class="small" style="margin-bottom:20px;">Punkty eventowe zdobywasz tylko za otwieranie skrzynek (Case Battle siƒô nie liczy)</div>
  <div style="margin-top:12px" id="eventShopItems">
    <!-- Event shop items will be generated here -->
  </div>
</div>

<!-- EKWIPUNEK -->
<div id="inventory" style="padding:18px;text-align:center;display:none;">
  <h3 style="color:#ff3399">Tw√≥j Ekwipunek</h3>
  
  <!-- Sortowanie -->
  <div class="inventory-sort">
    <label class="small">Sortuj wed≈Çug ceny:</label><br>
    <button class="sort-btn" id="sortDesc" onclick="sortInventory('desc')">Od najdro≈ºszych</button>
  </div>
  
  <button class="btn-big" onclick="sellAllUnlockedItems()" style="background:#ff6600;margin-bottom:20px;">SPRZEDAJ WSZYSTKIE PRZEDMIOTY</button>

  <div id="inventoryItems"></div>
</div>

<!-- KOLEKCJA -->
<div id="collectionScreen" style="display:none;padding:18px;text-align:center;">
  <h3 style="color:#ff3399">Twoja Kolekcja</h3>
  <div class="small" style="margin-bottom:20px;">Zbieraj przedmioty z ka≈ºdej skrzynki, aby uko≈Ñczyƒá kolekcje i zdobywaƒá klucze!</div>
  
  <div id="collectionContainer">
    <!-- Kolekcje bƒôdƒÖ generowane tutaj -->
  </div>
</div>

<script>
/* ---------------------- STAN APLIKACJI ---------------------- */
// RESET BALANSU TYLKO RAZ - dla nowych graczy
const isFirstVisit = !localStorage.getItem("pentoFirstVisit");
if (isFirstVisit) {
  localStorage.setItem("pentoFirstVisit", "true");
  localStorage.setItem("pentoBalance", "1000");
  localStorage.setItem("pentoInventory", "[]");
  localStorage.setItem("pentoLevel", "1");
  localStorage.setItem("pentoXP", "0");
  localStorage.setItem("pentoEventPoints", "0");
  localStorage.setItem("pentoKeys", "0");
  localStorage.setItem("pentoCollection", "{}");
}

let balance = parseInt(localStorage.getItem("pentoBalance")) || 1000;
let inventory = JSON.parse(localStorage.getItem("pentoInventory")) || [];
let playerLevel = parseInt(localStorage.getItem("pentoLevel")) || 1;
let playerXP = parseInt(localStorage.getItem("pentoXP")) || 0;
let currentAvatar = localStorage.getItem("pentoAvatar") || null;
let currentAvatarAnimation = localStorage.getItem("pentoAvatarAnimation") || null;
let claimedLevels = JSON.parse(localStorage.getItem("pentoClaimedLevels")) || [];
let eventPoints = parseInt(localStorage.getItem("pentoEventPoints")) || 0;
let keys = parseInt(localStorage.getItem("pentoKeys")) || 0;
let collection = JSON.parse(localStorage.getItem("pentoCollection")) || {};
let canStartBattle = true;
let inventorySortOrder = 'none'; // 'none', 'asc', 'desc'

const balanceEl = document.getElementById('balance');
const eventPointsEl = document.getElementById('eventPoints');
const keysCountEl = document.getElementById('keysCount');
const backButton = document.getElementById('backButton');

function updateBalance(){ 
  balanceEl.textContent = balance.toLocaleString() + ' z≈Ç'; 
  localStorage.setItem('pentoBalance', balance); 
}

function updateEventPoints(){ 
  eventPointsEl.textContent = eventPoints.toLocaleString(); 
  localStorage.setItem('pentoEventPoints', eventPoints); 
}

function updateKeys(){ 
  keysCountEl.textContent = keys.toLocaleString(); 
  localStorage.setItem('pentoKeys', keys); 
}

/* ---------------------- SYSTEM LEVELI ---------------------- */
function calculateRequiredXP(level) {
  return Math.floor(100 * Math.pow(1.15, level - 1));
}

function addXP(amount) {
  const requiredXP = calculateRequiredXP(playerLevel);
  playerXP += amount;
  
  while (playerXP >= requiredXP && playerLevel < 100) {
    playerXP -= requiredXP;
    playerLevel++;
    
    if (playerLevel % 5 === 0 && !claimedLevels.includes(playerLevel)) {
      const reward = playerLevel * 500;
      setTimeout(() => {
        if (confirm(`Gratulacje! OsiƒÖgnƒÖ≈Çe≈õ level ${playerLevel}! Odbierz nagrodƒô: ${reward.toLocaleString()} z≈Ç!`)) {
          balance += reward;
          claimedLevels.push(playerLevel);
          localStorage.setItem('pentoClaimedLevels', JSON.stringify(claimedLevels));
          updateBalance();
          updateLevelDisplay();
          alert(`Odebrano ${reward.toLocaleString()} z≈Ç!`);
        }
      }, 500);
    }
  }
  
  localStorage.setItem('pentoLevel', playerLevel);
  localStorage.setItem('pentoXP', playerXP);
  updateLevelDisplay();
}

function updateLevelDisplay() {
  const requiredXP = calculateRequiredXP(playerLevel);
  const progress = (playerXP / requiredXP) * 100;
  
  document.getElementById('levelProgress').style.width = `${progress}%`;
  document.getElementById('levelText').textContent = `Level ${playerLevel} | ${playerXP}/${requiredXP} XP`;
  
  if (playerLevel % 5 === 0 && !claimedLevels.includes(playerLevel)) {
    document.getElementById('levelText').textContent += ' ‚òÖ';
  }
}

// XP za r√≥≈ºne akcje
const xpRewards = {
  caseOpen: (caseCost) => Math.max(10, Math.floor(caseCost / 50)),
  battleWin: 50,
  battleParticipate: 20,
  shopPurchase: (itemPrice) => Math.floor(itemPrice / 100)
};

/* ---------------------- PUNKTY EVENTOWE ---------------------- */
function addEventPoints(min = 10, max = 100) {
  const points = Math.floor(Math.random() * (max - min + 1)) + min;
  eventPoints += points;
  updateEventPoints();
  
  // Pokazujemy powiadomienie o zdobytych punktach
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed; top: 100px; right: 20px; background: #ffcc00; color: #000; 
    padding: 10px 15px; border-radius: 8px; font-weight: bold; z-index: 10000;
    box-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
  `;
  notification.textContent = `+${points} punkt√≥w eventowych!`;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    document.body.removeChild(notification);
  }, 3000);
}

/* ---------------------- AWATAR I ANIMACJE ---------------------- */
function updateAvatar() {
  const avatarElement = document.getElementById('avatar');
  const avatarDefault = document.getElementById('avatarDefault');
  
  // Usu≈Ñ istniejƒÖce animacje
  const existingAnimation = avatarElement.querySelector('.avatar-animation');
  if (existingAnimation) {
    existingAnimation.remove();
  }
  
  if (currentAvatar) {
    avatarDefault.style.display = 'none';
    if (avatarElement.querySelector('img')) {
      avatarElement.querySelector('img').src = currentAvatar;
    } else {
      avatarElement.innerHTML = `<img src="${currentAvatar}" alt="Awatar">`;
    }
  } else {
    avatarDefault.style.display = 'flex';
    avatarElement.innerHTML = '<div class="avatar-default">AWATAR</div>';
  }
  
  // Dodaj animacjƒô POD zdjƒôciem je≈õli jest ustawiona
  if (currentAvatarAnimation) {
    const animation = document.createElement('div');
    animation.className = `avatar-animation ${currentAvatarAnimation}`;
    
    // Dodaj elementy specyficzne dla danej animacji
    if (currentAvatarAnimation === 'magic-circle') {
      animation.innerHTML = `
        <div class="rune">‚ö°</div>
        <div class="rune">üî•</div>
        <div class="rune">üíß</div>
        <div class="rune">üå™Ô∏è</div>
      `;
    } else if (currentAvatarAnimation === 'golden-glory') {
      animation.innerHTML = `
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
      `;
    }
    
    // Wstaw animacjƒô jako pierwszy element (pod zdjƒôciem)
    avatarElement.insertBefore(animation, avatarElement.firstChild);
  }
}

function changeAvatar() {
  const legendCaseSkins = inventory.filter(item => 
    cases[3].skins.some(skin => skin.name === item.name)
  );
  
  if (legendCaseSkins.length === 0) {
    alert('Nie masz ≈ºadnych skin√≥w z Legend Case w ekwipunku!');
    return;
  }
  
  let skinList = 'Wybierz skin na awatar:\n\n';
  legendCaseSkins.forEach((skin, index) => {
    skinList += `${index + 1}. ${skin.name}\n`;
  });
  
  const choice = prompt(skinList + '\nWpisz numer skinu:');
  const skinIndex = parseInt(choice) - 1;
  
  if (skinIndex >= 0 && skinIndex < legendCaseSkins.length) {
    currentAvatar = legendCaseSkins[skinIndex].img;
    localStorage.setItem('pentoAvatar', currentAvatar);
    updateAvatar();
    alert(`Ustawiono awatar: ${legendCaseSkins[skinIndex].name}`);
  } else if (choice !== null) {
    alert('Nieprawid≈Çowy wyb√≥r!');
  }
}

/* ---------------------- ZARZƒÑDZANIE ANIMACJAMI ---------------------- */
function changeAvatarAnimation() {
  // Pobierz wszystkie zakupione animacje
  const purchasedAnimations = avatarAnimations.filter(anim => 
    localStorage.getItem(`pentoAnimation_${anim.type}`) === 'purchased'
  );
  
  if (purchasedAnimations.length === 0) {
    alert('Nie masz ≈ºadnych zakupionych animacji! Odwied≈∫ sklep eventowy.');
    return;
  }
  
  let animationList = 'Wybierz animacjƒô:\n\n';
  purchasedAnimations.forEach((anim, index) => {
    animationList += `${index + 1}. ${anim.name} ${currentAvatarAnimation === anim.type ? '‚úì' : ''}\n`;
  });
  
  const choice = prompt(animationList + '\nWpisz numer animacji:');
  const animIndex = parseInt(choice) - 1;
  
  if (animIndex >= 0 && animIndex < purchasedAnimations.length) {
    currentAvatarAnimation = purchasedAnimations[animIndex].type;
    localStorage.setItem('pentoAvatarAnimation', currentAvatarAnimation);
    updateAvatar();
    alert(`Ustawiono animacjƒô: ${purchasedAnimations[animIndex].name}`);
  } else if (choice !== null) {
    alert('Nieprawid≈Çowy wyb√≥r!');
  }
}

/* ---------------------- KOLEKCJA ---------------------- */
function showCollection() {
  document.getElementById('mainMenu').style.display='none'; 
  document.getElementById('collectionScreen').style.display='block'; 
  document.getElementById('casesScreen').style.display='none';
  document.getElementById('battleScreen').style.display='none';
  document.getElementById('shopScreen').style.display='none';
  document.getElementById('inventory').style.display='none';
  document.getElementById('eventShopScreen').style.display='none';
  backButton.style.display = 'block';
  
  renderCollection();
}

function renderCollection() {
  const container = document.getElementById('collectionContainer');
  container.innerHTML = '';
  
  // Inicjalizacja kolekcji je≈õli nie istnieje
  if (Object.keys(collection).length === 0) {
    for (const caseId in cases) {
      collection[caseId] = {
        completed: false,
        rewardClaimed: false,
        items: cases[caseId].skins.map(skin => ({
          name: skin.name,
          collected: false
        }))
      };
    }
    localStorage.setItem('pentoCollection', JSON.stringify(collection));
  }
  
  for (const caseId in cases) {
    const caseData = cases[caseId];
    const caseCollection = collection[caseId];
    
    // Oblicz postƒôp kolekcji
    const collectedCount = caseCollection.items.filter(item => item.collected).length;
    const totalCount = caseCollection.items.length;
    const progress = Math.round((collectedCount / totalCount) * 100);
    
    const caseEl = document.createElement('div');
    caseEl.className = 'collection-case';
    
    // Nag≈Ç√≥wek skrzynki
    const headerEl = document.createElement('div');
    headerEl.className = 'collection-case-header';
    headerEl.innerHTML = `
      <img src="${caseData.img}" class="collection-case-icon">
      <div class="collection-case-info">
        <div class="collection-case-name">${caseData.name}</div>
        <div class="collection-case-progress">
          Postƒôp: <span class="collection-case-completed">${collectedCount}/${totalCount}</span> (${progress}%)
        </div>
      </div>
    `;
    
    // Przedmioty w kolekcji
    const itemsEl = document.createElement('div');
    itemsEl.className = 'collection-items';
    
    caseCollection.items.forEach((item, index) => {
      const skin = caseData.skins.find(s => s.name === item.name);
      const itemEl = document.createElement('div');
      itemEl.className = `collection-item ${item.collected ? 'collected' : 'missing'}`;
      itemEl.innerHTML = `
        <img src="${skin.img}" alt="${skin.name}">
        <div class="collection-item-chance">${skin.chance}%</div>
        ${item.collected ? '<div class="collection-item-check">‚úì</div>' : ''}
      `;
      
      if (!item.collected) {
        // Sprawd≈∫ czy gracz ma ten przedmiot w ekwipunku
        const hasItem = inventory.some(invItem => invItem.name === item.name);
        if (hasItem) {
          itemEl.style.cursor = 'pointer';
          itemEl.title = 'Kliknij, aby dodaƒá do kolekcji';
          itemEl.onclick = () => addToCollection(caseId, index);
        } else {
          itemEl.title = 'Nie posiadasz tego przedmiotu';
        }
      }
      
      itemsEl.appendChild(itemEl);
    });
    
    // Nagroda za uko≈Ñczenie kolekcji
    const rewardEl = document.createElement('div');
    rewardEl.className = `collection-reward ${caseCollection.completed ? 'completed' : ''}`;
    rewardEl.innerHTML = `
      <div style="color:#ffcc00;font-weight:700;margin-bottom:5px;">Nagroda za uko≈Ñczenie kolekcji:</div>
      <div style="display:flex;align-items:center;justify-content:center;">
        <img src="https://cdn-icons-png.freepik.com/512/7730/7730018.png" style="width:32px;height:32px;margin-right:10px;">
        <span style="font-weight:700;">1 KLUCZ</span>
      </div>
      ${caseCollection.completed ? 
        (caseCollection.rewardClaimed ? 
          '<div style="color:#0f0;margin-top:5px;">‚úì Nagroda odebrana</div>' : 
          `<button class="collection-reward-btn" onclick="claimCollectionReward('${caseId}')">ODBIERZ NAGRODƒò</button>`) : 
        '<div style="color:#ccc;margin-top:5px;">Uko≈Ñcz kolekcjƒô, aby otrzymaƒá nagrodƒô</div>'
      }
    `;
    
    caseEl.appendChild(headerEl);
    caseEl.appendChild(itemsEl);
    caseEl.appendChild(rewardEl);
    container.appendChild(caseEl);
  }
}

function addToCollection(caseId, itemIndex) {
  const itemName = collection[caseId].items[itemIndex].name;
  
  // Znajd≈∫ przedmiot w ekwipunku
  const itemIndexInInventory = inventory.findIndex(item => item.name === itemName);
  if (itemIndexInInventory === -1) {
    alert('Nie posiadasz tego przedmiotu!');
    return;
  }
  
  if (confirm(`Czy na pewno chcesz dodaƒá "${itemName}" do kolekcji?\n\nUWAGA: Przedmiot zostanie usuniƒôty z ekwipunku!`)) {
    // Dodaj do kolekcji
    collection[caseId].items[itemIndex].collected = true;
    
    // Sprawd≈∫ czy kolekcja jest uko≈Ñczona
    const allCollected = collection[caseId].items.every(item => item.collected);
    if (allCollected) {
      collection[caseId].completed = true;
    }
    
    // Usu≈Ñ przedmiot z ekwipunku
    inventory.splice(itemIndexInInventory, 1);
    
    // Zapisz zmiany
    localStorage.setItem('pentoCollection', JSON.stringify(collection));
    localStorage.setItem('pentoInventory', JSON.stringify(inventory));
    
    // Od≈õwie≈º widoki
    renderCollection();
    renderInventory();
    
    alert(`Dodano "${itemName}" do kolekcji!`);
    
    // Sprawd≈∫ czy aktualny awatar nie zosta≈Ç usuniƒôty
    if (currentAvatar && !inventory.some(item => item.img === currentAvatar)) {
      currentAvatar = null;
      localStorage.setItem('pentoAvatar', null);
      updateAvatar();
    }
  }
}

function claimCollectionReward(caseId) {
  if (collection[caseId].completed && !collection[caseId].rewardClaimed) {
    keys += 1;
    collection[caseId].rewardClaimed = true;
    
    localStorage.setItem('pentoKeys', keys);
    localStorage.setItem('pentoCollection', JSON.stringify(collection));
    
    updateKeys();
    renderCollection();
    
    alert('Gratulacje! Otrzyma≈Çe≈õ 1 klucz za uko≈Ñczenie kolekcji!');
  }
}

/* ---------------------- SKLEP EVENTOWY ---------------------- */
const avatarAnimations = [
  { 
    id: 1, 
    name: "Ognista Aura", 
    price: 2000, 
    type: "fire-aura",
    description: "P≈Çomienie otaczajƒÖce awatar"
  },
  { 
    id: 2, 
    name: "Elektryczne B≈Çyskawice", 
    price: 4000, 
    type: "electric-sparks",
    description: "Energetyczne wy≈Çadowania"
  },
  { 
    id: 3, 
    name: "Magiczny KrƒÖg", 
    price: 6000, 
    type: "magic-circle",
    description: "Tajemnicze runy magiczne"
  },
  { 
    id: 4, 
    name: "Kosmiczna Galaktyka", 
    price: 8000, 
    type: "cosmic-galaxy",
    description: "G≈Çƒôboki kosmos z gwiazdami"
  },
  { 
    id: 5, 
    name: "Z≈Çota Chwa≈Ça", 
    price: 10000, 
    type: "golden-glory",
    description: "Z≈Çocista aura presti≈ºu"
  }
];

function showEventShop() {
  document.getElementById('mainMenu').style.display='none'; 
  document.getElementById('eventShopScreen').style.display='block'; 
  document.getElementById('casesScreen').style.display='none';
  document.getElementById('battleScreen').style.display='none';
  document.getElementById('shopScreen').style.display='none';
  document.getElementById('inventory').style.display='none';
  document.getElementById('collectionScreen').style.display='none';
  backButton.style.display = 'block';
  
  renderEventShop();
}

function renderEventShop() {
  const container = document.getElementById('eventShopItems');
  container.innerHTML = '';
  
  avatarAnimations.forEach(anim => {
    const itemEl = document.createElement('div');
    itemEl.className = 'event-shop-item';
    
    // Sprawd≈∫ czy animacja jest ju≈º zakupiona
    const isPurchased = localStorage.getItem(`pentoAnimation_${anim.type}`) === 'purchased';
    
    // Tworzymy podglƒÖd animacji
    const preview = document.createElement('div');
    preview.className = 'event-shop-preview';
    const animationPreview = document.createElement('div');
    animationPreview.className = `avatar-animation ${anim.type}`;
    animationPreview.style.width = '150px';
    animationPreview.style.height = '150px';
    animationPreview.style.top = '0';
    animationPreview.style.left = '0';
    
    // Dodaj elementy specyficzne dla podglƒÖdu
    if (anim.type === 'magic-circle') {
      animationPreview.innerHTML = `
        <div class="rune">‚ö°</div>
        <div class="rune">üî•</div>
        <div class="rune">üíß</div>
        <div class="rune">üå™Ô∏è</div>
      `;
    } else if (anim.type === 'golden-glory') {
      animationPreview.innerHTML = `
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
        <div class="ray"></div>
      `;
    }
    
    preview.appendChild(animationPreview);
    
    itemEl.innerHTML = `
      ${preview.outerHTML}
      <div class="event-shop-item-name">${anim.name}</div>
      <div class="event-shop-item-price">${isPurchased ? 'ZAKUPIONO' : anim.price.toLocaleString() + ' punkt√≥w'}</div>
      <div class="event-shop-item-preview">${anim.description}</div>
      ${isPurchased ? 
        `<button class="btn-big" onclick="setAvatarAnimation('${anim.type}')" style="padding:8px 16px;font-size:14px;background:#00cc66;color:#000;margin-top:8px;" ${currentAvatarAnimation === anim.type ? 'disabled style="background:#666;"' : ''}>${currentAvatarAnimation === anim.type ? 'AKTYWNA' : 'AKTYWUJ'}</button>` :
        `<button class="btn-big" onclick="buyAvatarAnimation('${anim.type}', ${anim.id})" style="padding:8px 16px;font-size:14px;background:#ffcc00;color:#000;margin-top:8px;" ${eventPoints < anim.price ? 'disabled style="background:#666;"' : ''}>KUP ANIMACJƒò</button>`
      }
      ${currentAvatarAnimation === anim.type ? '<div style="color:#0f0;margin-top:5px;font-size:12px;">‚úì AKTYWNA</div>' : ''}
    `;
    container.appendChild(itemEl);
  });
}

function buyAvatarAnimation(animType, animId) {
  const anim = avatarAnimations.find(a => a.id === animId);
  if (!anim) return;
  
  if (eventPoints < anim.price) {
    alert('Za ma≈Ço punkt√≥w eventowych!');
    return;
  }
  
  if (confirm(`Czy na pewno chcesz kupiƒá animacjƒô "${anim.name}" za ${anim.price} punkt√≥w?\n\nAnimacja bƒôdzie wy≈õwietlana jako t≈Ço pod twoim awatarem.`)) {
    eventPoints -= anim.price;
    // Oznacz animacjƒô jako zakupionƒÖ
    localStorage.setItem(`pentoAnimation_${animType}`, 'purchased');
    // Automatycznie ustaw jako aktywnƒÖ
    currentAvatarAnimation = animType;
    localStorage.setItem('pentoAvatarAnimation', currentAvatarAnimation);
    
    updateEventPoints();
    updateAvatar();
    renderEventShop();
    alert(`Kupi≈Çe≈õ animacjƒô: ${anim.name}! Teraz bƒôdzie wy≈õwietlana pod twoim awatarem.`);
  }
}

function setAvatarAnimation(animType) {
  currentAvatarAnimation = animType;
  localStorage.setItem('pentoAvatarAnimation', currentAvatarAnimation);
  updateAvatar();
  renderEventShop();
    alert('Zmieniono aktywnƒÖ animacjƒô awatara!');
}

/* ---------------------- SKLEP ---------------------- */
const shopItems = [
  { id: 1, name: "Wild Lotus", price: 100000, img: "https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyLwlcK3wiFO0POlV61-LPGdCliWzeFkse1WQyC0nQlpsDuGyt-pdnyRPA4hDcYkR-QPuhi-wdPuYbyx5AaMidkQnC_-2ilIuzErvbi4ijV5Mw/360fx360f" },
  { id: 2, name: "Pandora Gloves", price: 90000, img: "https://imageproxy.waxpeer.com/insecure/rs:fit:300:170:0/g:nowe/f:webp/plain/https://steamcommunity-a.akamaihd.net/economy/image/class/730/2077639777" },
  { id: 3, name: "Hedge Maze", price: 80000, img: "https://imageproxy.waxpeer.com/insecure/rs:fit:552:385:0/g:nowe/f:webp/plain/https://steamcommunity-a.akamaihd.net/economy/image/class/730/2079266837" },
  { id: 4, name: "Butterfly Ruby", price: 70000, img: "https://imageproxy.waxpeer.com/insecure/rs:fit:552:385:0/g:nowe/f:webp/plain/https://steamcommunity-a.akamaihd.net/economy/image/class/730/2221323629" },
  { id: 5, name: "M9 Emerald", price: 60000, img: "https://skinbaron.de/steamdatadefault/apps/730/icons/econ/default_generated/weapon_knife_m9_bayonet_am_emerald_marbleized_light_large.5da41deaab71a392d147b3aafb5128bfbe5aefd1.png" },
  { id: 6, name: "Howl", price: 50000, img: "https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL8ypexwiFO0P_6afVSKP-EAm6extF6ueZhW2exwkl2tmTXwt39eCiUPQR2DMN4TOVetUK8xoLgM-K341eM2otDnC6okGoXufBz_TAB/360fx360f" },
  { id: 7, name: "Hydrophonica", price: 40000, img: "https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyLwlcK3wiNW0PCvZaZiL8-ZG2mXzetJvOhuRz39lk0m4Dncztz7Jy2fagIoC5t5QeNbskW6xNLgZu-24AXZgt4Xyi_4izQJsHjOr8RS6A/360fx360f" },
  { id: 8, name: "Golden Arabeska", price: 30000, img: "https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyLwlcK3wiVI0POlPPNSJ_-fCliR0-90tfJ4WiyMmBgjuiiI1Nn4cXjEbwMlDsR4RrVfsRK4wdPgPrjh4wKNg49Cyn__2iNI6ihi5O8cEf1yNgAZ7yU/330x192?allow_animated=1" },
  { id: 9, name: "Hydra", price: 20000, img: "https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyLwiYbf-jFk7uW-V6x0JOKSMWuZxuZi_uA7Syu2w0Ry4mqGzYypeH3DaAEnCpt0FuAK4RjrkoDgMb7mtFfcit5bjXKpX4RFZcA/360fx360f" },
  { id: 10, name: "Butterfly Lore", price: 10000, img: "https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIijyEKzb_3d19nuN3mZ6kVKpNa6vgjlRByknJOw-CEK7KP_bPZrefPGVmSTk7py4bY8Tivlx0Vw4z_SzsHpLyyu3lGzoA/330x192" }
];

function renderShop() {
  const shopContainer = document.getElementById('shopItems');
  shopContainer.innerHTML = '';
  shopItems.forEach(item => {
    const itemEl = document.createElement('div');
    itemEl.className = 'shop-item';
    itemEl.innerHTML = `
      <img src="${item.img}" alt="${item.name}">
      <div class="shop-item-name">${item.name}</div>
      <div class="shop-item-price">${item.price.toLocaleString()} z≈Ç</div>
      <button class="btn-big" onclick="buyItem(${item.id})" style="padding:8px 16px;font-size:14px;" ${balance < item.price ? 'disabled style="background:#666;"' : ''}>KUP</button>
    `;
    shopContainer.appendChild(itemEl);
  });
}

function buyItem(itemId) {
  const item = shopItems.find(i => i.id === itemId);
  if (!item) return;
  
  if (balance < item.price) {
    alert('Za ma≈Ço pieniƒôdzy!');
    return;
  }
  
  balance -= item.price;
  inventory.push({
    name: item.name,
    img: item.img,
    price: Math.round(item.price * 0.8),
    locked: false
  });
  
  addXP(xpRewards.shopPurchase(item.price));
  
  localStorage.setItem('pentoInventory', JSON.stringify(inventory));
  updateBalance();
  renderInventory();
  renderShop();
  alert(`Kupi≈Çe≈õ: ${item.name} za ${item.price.toLocaleString()} z≈Ç!`);
}

/* ---------------------- SKRZYNKI I SKINY ---------------------- */
const cases = {
  1: { name:'PENTO-CASE', cost:0, img:'https://i.postimg.cc/8zjR0TkZ/sdfsdfdfssdfsdf-Photoroom.png', skins:[
      {name:'Fade Skin', chance:2, basePrice:5000, img:'https://app.skin.land/market_images/172093_s.png'},
      {name:'Butterfly Knife Emerald', chance:0.5, basePrice:50000, img:'https://steamcommunity-a.akamaihd.net/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpovbSsLQJf0ebcZThQ6tCvq4GGqPL5NqnQmm9u5cRjiOXE_JbwjGu4ohQ0J3f6JtPEegNrMwvUrwe6kLjsjcPtuJXJmnFguCMn5i7enkDkiRFIabM7m7XAHtBCTvK7'},
      {name:'M4A4 Howl (FN)', chance:1, basePrice:20000, img:'https://app.skin.land/blogfiles/6UzHfAHTtqrJYDxxTK2nTjhrx4r7R3EuTVlVv3Yt.png'},
      {name:'Blaze Deagle', chance:4, basePrice:3000, img:'https://app.skin.land/blogfiles/h7WgeAP2MwvAPCtGyqwt4THV0iInH7YhasGFMZc0.png'},
      {name:'AK-47 (WW)', chance:4, basePrice:2500, img:'https://app.skin.land/market_images/11884_s.png'},
      {name:'Rarest CS2 Skins', chance:19, basePrice:500, img:'https://app.skin.land/market_images/9433_b.png'},
      {name:'Desert Eagle Printstream', chance:19, basePrice:800, img:'https://app.skin.land/market_images/147012_b.png'},
      {name:'PamiƒÖtka Kazirodcza', chance:21, basePrice:400, img:'https://app.skin.land/market_images/171775_s.png'},
      {name:'Random Market Skin', chance:21, basePrice:300, img:'https://app.skin.land/market_images/167290_b.png'}
  ]},
  2: { name:'DYCHA CASE', cost:1000, img:'https://i.postimg.cc/tR3XQ6vB/Zrzut-ekranu-2025-11-19-214235-removebg-preview.png', skins:[
      {name:'Dragon Lore', chance:1, basePrice:120000, img:'https://www.pngkey.com/png/full/439-4396345_added-a-new-cover-image-awp-dragon-lore.png'},
      {name:'Karambit Doppler', chance:3, basePrice:48000, img:'https://cache.steamanalyst.com/ad61b4d905c39f697215f90e8dd0119726d628dc.png'},
      {name:'AWP Gungnir', chance:4, basePrice:38000, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyLwiYbf-jFk7uW-V6N4LvedB3WvzedxuPUnHnjnzUl0sWrdztitI3rDZgJzAsZ1QOFY4UPqldDgMO_l41HXit9AmTK-0H227dAsvQ/360fx360f'},
      {name:'M9 Bayonet Crimson Web', chance:5, basePrice:32000, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL6kJ_m-B1Wts2sab1iLvWHMW-J_vlzsvJWQiy3nAgq_TzXw4yhdn_BOlMiDZt3TeULtxDqx4XhYu2x4AyI3toQzSmr2iJK7iZ1o7FVPvLt_5s/360fx360f'},
      {name:'Gloves Vice', chance:10, basePrice:4600, img:'https://app.skin.land/market_images/39408_s.png'},
      {name:'AK-47 Fire Serpent', chance:10, basePrice:4000, img:'https://ss.bleikstore.com/42659925063%2F2.webp'},
      {name:'USP-S Kill Confirmed', chance:10, basePrice:3260, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyLkjYbf7itX6vytbbZSI-WsG3SA_uV_vO1WTCa9kxQ1vjiBpYL8JSLSMxghCMEjEeNe5hHpw9zhYuOz5VfcitpBmyqt3X9O6itrsesFUfYmrKzTkUifZqPQtnZK/360fx360f'},
      {name:'Classic Knife Fade', chance:20, basePrice:1600, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL6kJ_m-B1Y_OGRaaVSJvGXC1icyOl-pK9tHn-yxhkltmTVnon4IHqUbgInWcN1ELIK5hS9xIbkZumx4wONjd9H02yg2Yau6XG6/360fx360f'},
      {name:'StatTrak Music Kit', chance:20, basePrice:1060, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIijyEKzb_3d19nuN3mZ6kVKpNa6vgjlRByknJOw-CEK7KP_bPZrefPGVmSTk7py4bY8Tivlx0Vw4z_SzsHpLyyu3lGzoA/330x192'},
      {name:'Random High-Tier Skin', chance:17, basePrice:600, img:'https://images.steamusercontent.com/ugc/2019350432622307608/8C495B331C0D24D0080332AD40DA55DBE2427E8B/'}
  ]},
  3: { name:'LEGEND CASE', cost:5000, img:'https://i.postimg.cc/G2Ty8xTk/dddddddd-removebg-preview.png', skins:[
      {name:'Donk', chance:1, basePrice:100000, img:'https://img-cdn.hltv.org/playerbodyshot/sEwjjWjn36V9aqH6i07aFx.png?ixlib=java-2.1.0&w=400&s=14a4ef10ad0fcd029d9b8872437a697e'},
      {name:'Simple', chance:2, basePrice:50000, img:'https://img-cdn.hltv.org/playerbodyshot/O2mYq7Td1la8B8xGC-dYr8.png?ixlib=java-2.1.0&w=400&s=a1921e5df7d31e47aadc050ab4c0ff55'},
      {name:'Ropz', chance:3, basePrice:20000, img:'https://img-cdn.hltv.org/playerbodyshot/lC8JyY0y43QcoKDC41ZeEX.png?ixlib=java-2.1.0&w=400&s=1d505a7641e5358937808e5dbf6ca54c'},
      {name:'Jcobbb', chance:4, basePrice:10000, img:'https://img-cdn.hltv.org/playerbodyshot/dCtnbnCxEWJe5rz5ddEdZX.png?ixlib=java-2.1.0&w=400&s=bf7c84bed88d8bf3cfa8f382ff42b92d'},
      {name:'Xantares', chance:5, basePrice:6000, img:'https://prosettings.net/cdn-cgi/image/dpr=1%2Cf=auto%2Cfit=cover%2Ch=400%2Cq=85%2Cw=400/wp-content/uploads/xantares.webp'},
      {name:'Molodoy', chance:10, basePrice:5500, img:'https://img-cdn.hltv.org/playerbodyshot/oPoWLYFq87cIs2cYDo8id7.png?ixlib=java-2.1.0&w=400&s=26d135bacbf9f98ff775421c3ca2bf4c'},
      {name:'Kyousuke', chance:15, basePrice:5000, img:'https://img-cdn.hltv.org/playerbodyshot/_s6UUQ4E92xw1uSWWCafsK.png?ixlib=java-2.1.0&w=400&s=d94a122aa9a8ec89f0727656b69e2415'},
      {name:'Snax', chance:20, basePrice:4000, img:'https://img-cdn.hltv.org/playerbodyshot/PCtBkxFzx6KVhnaGxgVoQa.png?ixlib=java-2.1.0&w=400&s=f0b074cfa6e7dfb5cbf439b5fdd8e08b'},
      {name:'SzeliS', chance:25, basePrice:2137, img:'https://i.postimg.cc/x8tNTZ7y/bvbvbvbvbvbvbvvvvbvbv.png'}
  ]},
  5: { name:'KAMIKAZE CASE', cost:10000, img:'https://i.postimg.cc/kM09QYFF/4-shoty-kamikaze.png', skins:[
      {name:'Butterfly Sapphire', chance:1, basePrice:290000, img:'https://steamcommunity-a.akamaihd.net/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpovbSsLQJf0ebcZThQ6tCvq4GGqOT1I6vZn3lU18hwmOvN8IXvjVCLqSwwOj6rYJiTdQE7NQuEqFS7x7q9hpHovZrPmnpq6HJ24XmJzUDjgBpOarBug_fKVxzAUBpccViW'},
      {name:'M9 Sapphire', chance:3, basePrice:150000, img:'https://cs.money/assets/rs:fit:140:105:0/q:100/f:webp/dpr:2/plain/https://steamcommunity-a.akamaihd.net/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL6kJ_m-B1Wts2sab1iLvWHMWad_up5oPFlSjuMhRUmoDjWpYPwJiPTcFBzDcQhFuJf4BiwmtzmP7iw5QXc3YsUzn6oiikauCg44uoEAqQl_6bJz1aWfAW50lg'},
      {name:'AWP Medusa', chance:4, basePrice:50000, img:'https://steamcommunity-a.akamaihd.net/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpot621FAR17P7NdShR7eO3g5C0m_7zO6-fxj5SvsMkib-W9N7zilLjr0NoYW_wI4OTelRvYwmC-FTrxeq915a074OJlyVOUzvCjQ'},
      {name:'Gloves Amphibious', chance:5, basePrice:40000, img:'https://community.akamai.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Tk5UvzWCL2kpn2-DFk_OKherB0H-CcB3Sfz9Fwou5ucCu_gBgYpDWMjorGLC7DN0N9FJZyFrNe5hm8lNzmP-u05wHfjN8UmCX6hiJM5i06sugLAvcnqaKEj1vfcepqZ8GDv-w/330x192?allow_animated=1'},
      {name:'Talon Sapphire', chance:10, basePrice:10000, img:'https://skinbaron.de/steamdatadefault/apps/730/icons/econ/default_generated/weapon_knife_widowmaker_am_sapphire_marbleized_light_large.83a9aa7abffc20bde9d27ca616ebb9b485be7b75.png'},
      {name:'Cobalt Skulls', chance:10, basePrice:8500, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu4vx603vRA_Olpfu-TVJ7uK9V6xsLvSEHGaA_uJzsfVhSjuqqhsmsS-MmbD7LT7CAUV7T84sBohX50Th14n5Yb6zswCP2N9NmySt2iNKvyw65O0LWKIn__WB2l3FObc-6JEHcfejTgPOBksTwoxH2w/360fx360f'},
      {name:'Stiletto Sapphire', chance:10, basePrice:7500, img:'https://skinbaron.de/steamdatadefault/apps/730/icons/econ/default_generated/weapon_knife_stiletto_am_sapphire_marbleized_light_large.3576bab97db4e79a0c125f861a454a0c7abe8322.png'},
      {name:'Shadow Daggers Doppler', chance:18, basePrice:5000, img:'https://steamcommunity-a.akamaihd.net/economy/image/class/730/2245432321'},
      {name:'Gut Bright Water', chance:20, basePrice:700, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL6kJ_m-B1c-uaRYL1SL_OWD2mvyuB_tuRWQyC0nQlp4TiDntmtIiqeblAmDsB2QLMNukSxwNDkZOrg4wbajItNzXn4in9LvDErvbi4dh8COQ/330x192?allow_animated=1'},
      {name:'M4A1-S Nightmare', chance:17, basePrice:200, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL8ypexwjFS4_ega6F_H_OGMWrEwL9lj-9gSCGnmBw1tgKIn4vwNCaJaAJ1WZNwE-Rft0G8kIKyNui24lPcjoNFn3n3iCtMuHo447tWVfcjqbqX0V8N9uh_hA/360fx360f'}
  ]},
  4: { name:'RASZEI CASE', cost:20000, img:'https://i.postimg.cc/1tkMv4yZ/Zrzut-ekranu-2025-11-25-144511-removebg-preview.png', skins:[
      // RZADKIE SKINY - WYSOKIE CENY
      {name:'Superconductor Gloves', chance:2, basePrice:180000, img:'https://cdn.tradeit.gg/csgo%2F%E2%98%85%20Sport%20Gloves%20-%20Superconductor%20(Factory%20New)_240x152.webp'},
      {name:'Butterfly Black Pearl', chance:2, basePrice:150000, img:'https://cdn.skinsmonkey.com/econ/default_generated/weapon_knife_butterfly_am_blackpearl_marbleized_b_light_png.png'},
      {name:'Karambit Emerald', chance:2, basePrice:130000, img:'https://ss.bitskins.com/ce/cec0a9e9ed34b987c976a9ce78d47e78-front.webp'},
      
      // EPICKIE SKINY - DOBRE CENY
      {name:'M4A1-S Knight', chance:5, basePrice:60000, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL8ypexwjFS4_ega6F_H_GeMWqV1e96o95lRi67gVNwsWTQzdn4JHyQZ1QhWMZyQe5YsxK-ktPnZOiwtVDcjo9ExS393ytB8G81tGXpYjdX/360fx360f'},
      {name:'Fade Gloves', chance:8, basePrice:45000, img:'https://steamcommunity-a.akamaihd.net/economy/image/class/730/2737835643'},
      
      // RZADKIE SKINY - ≈öREDNIE CENY
      {name:'Falchion Tiger Tooth', chance:12, basePrice:25000, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL6kJ_m-B1d7v6tYK1iLs-SAFiEyOlzot5mXSi9khgYvzSCkpu3cCiRZwIiDcZ2ReEO4EW5xtXlMuO05weKjYNBxS-tjytOvC495u0BWb1lpPPh4hsqrQ/360fx360f'},
      {name:'Navaja Fade', chance:15, basePrice:18000, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL6kJ_m-B1c9uK9cZtnIfOYBWmZx-tJseBWSSi3kCIrujqNjsH7c3qVOwV2DcZyQbQOukG5m4CyMeqz4laIgoxAnH_93Ckbvyw5troCT-N7rT3KN2DN/330x192?allow_animated=1'},
      
      // CZƒòSTE SKINY - DOBRE CENY (NISKIE SZANSE NA STRATƒò)
      {name:'AK-47 Frontside Misty', chance:20, basePrice:12000, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyLwlcK3wiFO0POlPPNSN_mdGmKC_v1mv_N9cCS2kRQyvnPdzdurInKSbwIoDMN4Ru8KtUW7l9axZuzmtFSPjY4WxHj63ywau3to_a9cBuQ0aznH/360fx360f'},
      {name:'M4A4 Fairy Tooth', chance:20, basePrice:10000, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyL8ypexwiFO0P_6afBSMeWWC2mWwOdkqd5kSi26gBBp4G7dm4qtJ3yTbVMpCcNyFLEJ5xHqlNfvZOKwtlHWjIIRxCT5hi4b6zErvbhXXMLnPQ/360fx360f'},
      {name:'USP Check Engine', chance:16, basePrice:8000, img:'https://community.fastly.steamstatic.com/economy/image/i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyLkjYbf7itX6vytbbZSM-CsA2KDydFlsedsWzChkBkYvzSCkpu3Iy6RbQYnXJZ2F7QN4UPqkIfmNeni5laNit1Dyiz42C5JvCdo57xQA71lpPMz6iO7bg/360fx360f'}
  ]}
};

/* ---------------------- GLOBAL UI HELPERS ---------------------- */
function showCases(){ 
  document.getElementById('mainMenu').style.display='none'; 
  document.getElementById('casesScreen').style.display='block'; 
  document.getElementById('shopScreen').style.display='none';
  document.getElementById('inventory').style.display='none';
  document.getElementById('eventShopScreen').style.display='none';
  document.getElementById('collectionScreen').style.display='none';
  backButton.style.display = 'block';
}
function showBattle(){ 
  document.getElementById('mainMenu').style.display='none'; 
  document.getElementById('battleScreen').style.display='block'; 
  document.getElementById('shopScreen').style.display='none';
  document.getElementById('inventory').style.display='none';
  document.getElementById('eventShopScreen').style.display='none';
  document.getElementById('collectionScreen').style.display='none';
  battleSelectedCases=[]; 
  battleBots=1; 
  document.getElementById('battleSelected').innerText='Brak skrzynek'; 
  document.getElementById('battleArea').innerHTML=''; 
  document.getElementById('battleResult').innerHTML=''; 
  canStartBattle = true;
  document.getElementById('startBattleBtn').disabled = false;
  updateBattleInfo();
  backButton.style.display = 'block';
}
function showShop(){ 
  document.getElementById('mainMenu').style.display='none'; 
  document.getElementById('shopScreen').style.display='block'; 
  document.getElementById('casesScreen').style.display='none';
  document.getElementById('battleScreen').style.display='none';
  document.getElementById('inventory').style.display='none';
  document.getElementById('eventShopScreen').style.display='none';
  document.getElementById('collectionScreen').style.display='none';
  renderShop();
  backButton.style.display = 'block';
}
function showInventory(){ 
  document.getElementById('mainMenu').style.display='none'; 
  document.getElementById('inventory').style.display='block'; 
  document.getElementById('casesScreen').style.display='none';
  document.getElementById('battleScreen').style.display='none';
  document.getElementById('shopScreen').style.display='none';
  document.getElementById('eventShopScreen').style.display='none';
  document.getElementById('collectionScreen').style.display='none';
  backButton.style.display = 'block';
  renderInventory();
}
function backToMenu(){ 
  document.getElementById('casesScreen').style.display='none'; 
  document.getElementById('battleScreen').style.display='none'; 
  document.getElementById('shopScreen').style.display='none';
  document.getElementById('inventory').style.display='none';
  document.getElementById('eventShopScreen').style.display='none';
  document.getElementById('collectionScreen').style.display='none';
  document.getElementById('mainMenu').style.display='block'; 
  backButton.style.display = 'none';
}

/* ---------------------- OTWIERANIE POJEDYNCZE ---------------------- */
let currentCaseId=null, canRoll=true;
function openCase(id){ 
  currentCaseId=id; 
  document.getElementById('caseBox').src = cases[id].img; 
  document.getElementById('rollContainer').style.display='none'; 
  document.getElementById('pointer').style.display='none'; 
  document.getElementById('result').innerHTML=''; 
}
function startRoll(){
  if(!canRoll || !currentCaseId) return;
  const c = cases[currentCaseId];
  if(c.cost>0 && balance<c.cost){ alert('Za ma≈Ço pieniƒôdzy!'); return;}
  if(c.cost>0){ balance -= c.cost; updateBalance(); }
  canRoll=false; setTimeout(()=>canRoll=true,1500);
  const container=document.getElementById('rollContainer'), roll=document.getElementById('roll'), pointer=document.getElementById('pointer'), result=document.getElementById('result');
  result.innerHTML=''; roll.innerHTML=''; container.style.display='block'; pointer.style.display='block';
  const finalSkin = weightedRandom(c.skins);
  const price = Math.round(finalSkin.basePrice / (finalSkin.chance/3));
  const items=[]; for(let i=0;i<28;i++) items.push(randomSkin(c.skins)); items.push(finalSkin); for(let i=0;i<12;i++) items.push(randomSkin(c.skins));
  items.forEach(s => {
    const chanceText = s.chance < 1 ? s.chance.toFixed(1) + '%' : s.chance + '%';
    roll.innerHTML += `<div class="item"><img src="${s.img}"><div class="item-chance">${chanceText}</div></div>`;
  });
  const itemW=220, finalPos = -(itemW*28) + (container.clientWidth/2)-(itemW/2);
  roll.style.transition='none'; roll.style.left='0px';
  requestAnimationFrame(()=>{ roll.style.transition='left 5.2s cubic-bezier(0.22,0.61,0.36,1)'; roll.style.left = finalPos + 'px'; setTimeout(()=>{ 
    inventory.push({...finalSkin, price, locked: false}); 
    localStorage.setItem('pentoInventory', JSON.stringify(inventory)); 
    renderInventory(); 
    
    // Dodaj XP za otwarcie skrzynki
    addXP(xpRewards.caseOpen(c.cost));
    
    // Dodaj punkty eventowe za otwarcie skrzynki
    addEventPoints(10, 100);
    
    const chanceText = finalSkin.chance < 1 ? finalSkin.chance.toFixed(1) + '%' : finalSkin.chance + '%';
    result.innerHTML = `<h3 style="color:#ff3399">WYGRA≈ÅE≈ö!</h3><p>${finalSkin.name}</p><p style="color:#0f0">${price.toLocaleString()} z≈Ç</p><p style="color:#ffd700;font-size:12px">Szansa: ${chanceText}</p><img src="${finalSkin.img}" style="width:260px;border:4px solid #ff3399;border-radius:12px;margin-top:10px;">`; 
  },5400); });
}

/* ---------------------- BATTLE (CASE BATTLE) ---------------------- */
let battleBots = 1;
let battleSelectedCases = [];

function battleSetBots(n){ battleBots=n; renderBattleUI(); }
function battleAddCase(id){ 
  if(battleSelectedCases.length >= 20) {
    alert('Maksymalnie mo≈ºna dodaƒá 20 skrzynek do bitwy!');
    return;
  }
  battleSelectedCases.push(id); 
  renderBattleUI(); 
  updateBattleInfo();
}

function updateBattleInfo() {
  const count = battleSelectedCases.length;
  const totalCost = battleSelectedCases.reduce((sum, id) => sum + (cases[id].cost || 0), 0);
  document.getElementById('battleCount').textContent = count;
  document.getElementById('battleCost').textContent = totalCost.toLocaleString();
}

function renderBattleUI(){
  document.getElementById('battleSelected').innerText = battleSelectedCases.length===0 ? 'Brak skrzynek' : battleSelectedCases.map(i=>cases[i].name).join(', ');
}

function startBattle(){
  if(!canStartBattle) return;
  if(battleSelectedCases.length===0) return alert('Wybierz przynajmniej jednƒÖ skrzynkƒô do bitwy');

  canStartBattle = false;
  document.getElementById('startBattleBtn').disabled = true;

  let totalCost = battleSelectedCases.reduce((sum, id) => sum + (cases[id].cost || 0), 0);
  if(balance < totalCost) {
    alert(`Za ma≈Ço pieniƒôdzy! Potrzebujesz ${totalCost.toLocaleString()} z≈Ç`);
    canStartBattle = true;
    document.getElementById('startBattleBtn').disabled = false;
    return;
  }
  balance -= totalCost;
  updateBalance();

  const playersCount = 1 + battleBots;
  const players = Array.from({length:playersCount}).map((_,i)=> ({id:i, name: i===0? 'Ty' : 'Bot '+i, rounds: [], total:0, itemsCount:0}) );

  for(const caseId of battleSelectedCases){
    const c = cases[caseId];
    for(let p=0;p<playersCount;p++){
      const s = weightedRandom(c.skins);
      const price = Math.round(s.basePrice / (s.chance/3));
      players[p].rounds.push({caseId, name:s.name, img:s.img, price, chance:s.chance});
    }
  }

  const area = document.getElementById('battleArea');
  area.innerHTML = '';
  players.forEach(p => {
    const slot = document.createElement('div');
    slot.className = 'player-slot' + (p.id===0? ' you':'');
    slot.id = `player_slot_${p.id}`;
    slot.innerHTML = `<div class="name">${p.name}</div>
                      <div class="box" id="box_${p.id}"><div style="color:#666">?</div></div>
                      <div class="info">Suma: <span class="val" id="val_${p.id}">0</span> z≈Ç</div>
                      <div class="info">Przedmioty: <span class="count" id="count_${p.id}">0</span></div>`;
    area.appendChild(slot);
  });

  document.getElementById('battleResult').innerHTML = '';

  const rounds = players[0].rounds.length;
  let roundIndex = 0;

  function animatePlayerSmallRoll(player, roundItem, roundNum){
    return new Promise(resolve => {
      const box = document.getElementById(`box_${player.id}`);
      const smallRoll = document.createElement('div');
      smallRoll.className = 'small-roll';
      smallRoll.style.left = '0px';

      const c = cases[ roundItem.caseId ];
      const items = [];
      for(let i=0;i<28;i++) items.push(randomSkin(c.skins));
      items.push({name: roundItem.name, img: roundItem.img, chance: roundItem.chance});
      for(let i=0;i<12;i++) items.push(randomSkin(c.skins));

      items.forEach(it => {
        const itEl = document.createElement('div');
        itEl.className = 'small-item';
        const chanceText = it.chance < 1 ? it.chance.toFixed(1) + '%' : it.chance + '%';
        itEl.innerHTML = `<img src="${it.img}" style="width:140px;height:140px;object-fit:contain">
                         <div class="small-item-chance">${chanceText}</div>`;
        smallRoll.appendChild(itEl);
      });

      box.innerHTML = '';
      box.appendChild(smallRoll);

      const roundCounter = document.createElement('div');
      roundCounter.className = 'round-counter';
      roundCounter.textContent = `${roundNum}/${rounds}`;
      box.parentElement.appendChild(roundCounter);

      const itemW = 160;
      const finalPos = -(itemW * 28) + (box.clientWidth/2) - (itemW/2);

      requestAnimationFrame(()=> {
        smallRoll.style.transition = 'left 5.2s cubic-bezier(0.22,0.61,0.36,1)';
        smallRoll.style.left = finalPos + 'px';
      });

      setTimeout(()=> {
        const chanceText = roundItem.chance < 1 ? roundItem.chance.toFixed(1) + '%' : roundItem.chance + '%';
        box.innerHTML = `<img src="${roundItem.img}" style="width:140px;height:140px;object-fit:contain">
                        <div class="small-item-chance">${chanceText}</div>`;
        resolve(roundItem);
      }, 5400);
    });
  }

  async function playRoundsAsync(){
    while(roundIndex < rounds){
      const promises = players.map(p => {
        const roundItem = p.rounds[roundIndex];
        return animatePlayerSmallRoll(p, roundItem, roundIndex + 1).then(revealedItem => {
          p.total += revealedItem.price;
          p.itemsCount += 1;
          document.getElementById(`val_${p.id}`).textContent = p.total.toLocaleString();
          document.getElementById(`count_${p.id}`).textContent = p.itemsCount;
          let leader = players[0];
          players.forEach(pl => { if(pl.total > leader.total) leader = pl; });
          players.forEach(pl => {
            const slot = document.getElementById(`player_slot_${pl.id}`);
            if(pl.id === leader.id) slot.classList.add('leading'); else slot.classList.remove('leading');
          });
        });
      });
      await Promise.all(promises);
      await new Promise(r => setTimeout(r, 300));
      roundIndex++;
    }

    const winner = players.reduce((a,b)=> a.total>=b.total? a: b);
    const winnerIndex = players.indexOf(winner);
    const pooledItems = [];
    players.forEach(p => p.rounds.forEach(r => pooledItems.push(r)));
    if(winner.id === 0){
      pooledItems.forEach(it => { 
        inventory.push({
          name: it.name, 
          img: it.img, 
          price: it.price,
          locked: false
        }); 
      });
      localStorage.setItem('pentoInventory', JSON.stringify(inventory));
      renderInventory();
      
      addXP(xpRewards.battleWin);
    } else {
      addXP(xpRewards.battleParticipate);
    }

    document.getElementById('battleResult').innerHTML = `<h3 style="color:gold">ZWYCIƒòZCA: ${winner.name} ‚Äî ${winner.total.toLocaleString()} z≈Ç</h3>
        <p>${winner.id===0 ? 'Wygra≈Çe≈õ i zgarnƒÖ≈Çe≈õ wszystkie przedmioty z bitwy.' : 'Bot wygra≈Ç ‚Äî przedmioty trafi≈Çy do bota.'}</p>`;
    const winSlot = document.getElementById(`player_slot_${winnerIndex}`);
    if(winSlot) winSlot.classList.add('winner');
    
    setTimeout(() => {
      canStartBattle = true;
      document.getElementById('startBattleBtn').disabled = false;
    }, 1000);
  }

  playRoundsAsync();
}

/* ---------------------- EKWIPUNEK ---------------------- */
function renderInventory(){
  const el = document.getElementById('inventoryItems'); 
  el.innerHTML = inventory.length===0 ? '<p style="color:#666">Ekwipunek pusty</p>' : '';
  
  // Sortowanie je≈õli jest ustawione
  let sortedInventory = [...inventory];
  if (inventorySortOrder === 'asc') {
    sortedInventory.sort((a, b) => (a.price || 0) - (b.price || 0));
  } else if (inventorySortOrder === 'desc') {
    sortedInventory.sort((a, b) => (b.price || 0) - (a.price || 0));
  }
  
  sortedInventory.forEach((it,i)=>{
    const originalIndex = inventory.indexOf(it);
    const d=document.createElement('div'); 
    d.className='inv-item' + (it.locked ? ' locked' : ''); 
    d.style.cssText='display:inline-block;width:190px;margin:12px;padding:10px;background:#111;border-radius:10px;border:1px solid #333;';
    
    let chanceText = '';
    for (const caseId in cases) {
      const skin = cases[caseId].skins.find(s => s.name === it.name);
      if (skin) {
        chanceText = `${skin.chance}%`;
        break;
      }
    }
    
    d.innerHTML = `
      <img src="${it.img}">
      ${chanceText ? `<div class="inv-item-chance">${chanceText}</div>` : ''}
      <div class="inv-item-lock" onclick="toggleLock(${originalIndex})">${it.locked ? 'üîí' : 'üîì'}</div>
      <div style="font-weight:700;margin-top:8px">${it.name}</div>
      <div style="color:#0f0">${it.price?.toLocaleString()||0} z≈Ç</div>
      <button style="margin-top:8px;padding:8px;border-radius:8px;background:#ff3399;border:none;cursor:pointer" onclick="sellItem(${originalIndex})" ${it.locked ? 'disabled style="background:#666;"' : ''}>SPRZEDAJ</button>
    `;
    el.appendChild(d);
  });
}

function sortInventory(order) {
  inventorySortOrder = order;
  
  // Aktualizacja przycisk√≥w
  document.getElementById('sortDesc').classList.toggle('active', order === 'desc');
  
  renderInventory();
}

function toggleLock(index) {
  if (index >= 0 && index < inventory.length) {
    inventory[index].locked = !inventory[index].locked;
    localStorage.setItem('pentoInventory', JSON.stringify(inventory));
    renderInventory();
  }
}

function sellItem(index) {
  if (index >= 0 && index < inventory.length) {
    const item = inventory[index];
    if (item.locked) {
      alert('Ten przedmiot jest zablokowany! Odblokuj go przed sprzeda≈ºƒÖ.');
      return;
    }
    
    balance += item.price || 0;
    inventory.splice(index, 1);
    localStorage.setItem('pentoInventory', JSON.stringify(inventory));
    updateBalance();
    renderInventory();
    
    if (currentAvatar === item.img) {
      currentAvatar = null;
      localStorage.setItem('pentoAvatar', null);
      updateAvatar();
    }
  }
}

function sellAllUnlockedItems() {
  const unlockedItems = inventory.filter(item => !item.locked);
  
  if (unlockedItems.length === 0) {
    alert('Brak odblokowanych przedmiot√≥w do sprzeda≈ºy!');
    return;
  }
  
  const totalValue = unlockedItems.reduce((sum, item) => sum + (item.price || 0), 0);
  if (confirm(`Czy na pewno chcesz sprzedaƒá wszystkie odblokowane przedmioty (${unlockedItems.length}) za ${totalValue.toLocaleString()} z≈Ç?`)) {
    // Usu≈Ñ odblokowane przedmioty z ekwipunku
    inventory = inventory.filter(item => item.locked);
    
    balance += totalValue;
    localStorage.setItem('pentoInventory', JSON.stringify(inventory));
    updateBalance();
    renderInventory();
    
    // Sprawd≈∫ czy aktualny awatar nie zosta≈Ç sprzedany
    if (currentAvatar && !inventory.some(item => item.img === currentAvatar)) {
      currentAvatar = null;
      localStorage.setItem('pentoAvatar', null);
      updateAvatar();
    }
    
    alert(`Sprzedano ${unlockedItems.length} przedmiot√≥w za ${totalValue.toLocaleString()} z≈Ç!`);
  }
}

window.sellItem = sellItem;

/* ---------------------- UTILS ---------------------- */
function weightedRandom(arr){
  const total = arr.reduce((a,b)=>a+b.chance,0);
  let r = Math.random()*total, cur=0;
  for(const s of arr){ cur+=s.chance; if(r<=cur) return s; }
  return arr[arr.length-1];
}
function randomSkin(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* ---------------------- INIT ---------------------- */
updateBalance();
updateEventPoints();
updateKeys();
renderInventory();
battleSetBots(1);
renderBattleUI();
updateAvatar();
updateLevelDisplay();

// Dodajemy mo≈ºliwo≈õƒá zmiany animacji przez klikniƒôcie na awatar
document.getElementById('avatar').addEventListener('click', function(e) {
  if (e.altKey) { // Alt + klikniƒôcie na awatar otwiera menu zmiany animacji
    changeAvatarAnimation();
  } else {
    changeAvatar();
  }
});
</script>
</body>
</html>

